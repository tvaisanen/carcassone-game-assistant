{"version":3,"sources":["re_frisk/ui.cljs"],"mappings":"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","names":["re-frisk.ui/on-external-window-unload","app","re-frisk.inlined-deps.reagent.v1v0v0.reagent.dom/unmount-component-at-node","cljs.core.swap_BANG_","re-frisk.db/tool-state","cljs.core/assoc","re-frisk.ui/mount-external","window","doc","re-frame-data","goog.object/set","re-frisk.subs-graph/init","re_frisk.inlined_deps.reagent.v1v0v0.reagent.dom.render","re-frisk.ui.views/main-view","re-frisk.ui/open-debugger-window","map__39229","cljs.core/--destructure-map","cljs.core.get","ext_height","ext_width","cljs.core/deref","win","js/window.open","or__4223__auto__","re-frisk.ui.external-hml/html-doc","re-frisk.ui/on-iframe-load","iframe","js/document","re-frisk.ui/inner-view","ext-opened?","re-frisk.inlined-deps.reagent.v1v0v0.reagent.ratom/make-reaction","latest-left","left","re-frisk.utils/normalize-draggable","re-frisk.ui.components.drag/draggable","js/window.innerWidth","re-frisk.ui.style/inner-view-container","re-frisk.ui.style/external-button","re-frisk.utils/closed?","re-frisk.ui.style/dragg-button","re-frisk.ui.components.drag/mouse-down-handler","re-frisk.ui/mount-internal","div"],"sourcesContent":["(ns re-frisk.ui\n  (:require-macros [re-frisk.inlined-deps.reagent.v1v0v0.reagent.ratom :refer [reaction]])\n  (:require [re-frisk.utils :as utils]\n            [re-frisk.ui.style :as style]\n            [re-frisk.inlined-deps.reagent.v1v0v0.reagent.dom :as rdom]\n            [re-frisk.ui.components.drag :as drag]\n            [re-frisk.ui.external-hml :as external-hml]\n            [re-frisk.db :as db]\n            [re-frisk.subs-graph :as subs-graph]\n            [re-frisk.ui.views :as ui.views]))\n\n(defn on-external-window-unload [app]\n  (fn []\n    (rdom/unmount-component-at-node app)\n    (swap! db/tool-state assoc :ext-win-opened? false)))\n\n(defn mount-external [window doc re-frame-data]\n  (let [app (.getElementById doc \"re-frisk-debugger-div\")]\n    (goog.object/set window \"onunload\" (on-external-window-unload app))\n    (swap! db/tool-state assoc :ext-win-opened? true :doc doc)\n    (subs-graph/init window doc)\n    (rdom/render\n     [:div {:style {:height \"100%\"}}\n      [ui.views/main-view re-frame-data db/tool-state doc]]\n     app)))\n\n(defn open-debugger-window [re-frame-data]\n  (fn []\n    (let [{:keys [ext_height ext_width]} (:opts @db/tool-state)\n          win (js/window.open \"\" \"Debugger\" (str \"width=\" (or ext_width 800)\n                                                 \",height=\" (or ext_height 800)\n                                                 \",resizable=yes,scrollbars=yes,status=no\"\n                                                 \",directories=no,toolbar=no,menubar=no\"))\n          doc (.-document win)]\n      (.open doc)\n      (.write doc external-hml/html-doc)\n      (goog.object/set win \"onload\" #(mount-external win doc re-frame-data))\n      (.close doc))))\n\n(defn on-iframe-load [re-frame-data]\n  (fn []\n    (let [iframe (.getElementById js/document \"re-frisk-iframe\")\n          doc (.-contentDocument iframe)\n          win (.-contentWindow iframe)]\n      (swap! db/tool-state assoc :doc doc)\n      (subs-graph/init win doc)\n      (rdom/render\n       [:div {:style {:height \"100%\"}}\n        [ui.views/main-view re-frame-data db/tool-state doc]]\n       (.getElementById doc \"re-frisk-debugger-div\")))))\n\n(defn inner-view [re-frame-data]\n  (let [ext-opened? (reaction (:ext-win-opened? @db/tool-state))\n        latest-left (reaction (:latest-left @db/tool-state))]\n    (fn []\n      (when-not @ext-opened?\n        (let [left (or (utils/normalize-draggable (:x @drag/draggable))\n                       (- js/window.innerWidth 30))]\n          [:div {:style (style/inner-view-container left (:offset @drag/draggable))}\n           [:div {:style {:display :flex :flex-direction :column :opacity 0.3}}\n            [:div {:style    style/external-button\n                   :on-click (open-debugger-window re-frame-data)}\n             \"\\u2197\"]\n            [:div {:style {:display :flex :flex 1 :justify-content :center :flex-direction :column}}\n             [:div {:style    style/external-button\n                    :on-click #(let []\n                                 (when-not (utils/closed? left)\n                                   (swap! db/tool-state assoc :latest-left (- js/window.innerWidth left)))\n                                 (swap! drag/draggable assoc :x (- js/window.innerWidth\n                                                                   (if (utils/closed? left) @latest-left 30))))}\n              (if (utils/closed? left) \"\\u2b60\" \"\\u2b62\")]\n             [:div {:style         style/dragg-button\n                    :on-mouse-down drag/mouse-down-handler}]]]\n           (when-not (utils/closed? left)\n             [:div {:style {:display :flex :flex 1 :width \"100%\" :height \"100%\"}}\n              [:iframe {:id      \"re-frisk-iframe\" :src-doc external-hml/html-doc :width \"100%\" :height \"100%\"\n                        :style   (if (:offset @drag/draggable) {:pointer-events :none} {:pointer-events :all})\n                        :on-load (on-iframe-load re-frame-data)}]])])))))\n\n(defn mount-internal [re-frame-data]\n  (let [div (.createElement js/document \"div\")]\n    (goog.object/set div \"style\"\n                     (str \"position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none;\"\n                          \"margin:0; padding:0; z-index:999999999;pointer-events: none;\"))\n    (.appendChild (.-body js/document) div)\n    (rdom/render [inner-view re-frame-data] div)))"]}